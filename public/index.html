<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Student Dashboard ‚Äî Polished</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style> body{font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;} </style>
  </head>
  <body class="bg-gray-50 dark:bg-gray-900">
    <div id="root"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
const {useState,useEffect,useRef} = React;

// Simple SVG logo component
function Logo({className}){
  return (<svg className={className} width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <rect x="2" y="4" width="20" height="14" rx="2" fill="url(#g)"></rect>
    <path d="M7 9h10" stroke="white" stroke-width="1.2" stroke-linecap="round"></path>
    <path d="M7 13h6" stroke="white" stroke-width="1.2" stroke-linecap="round"></path>
    <defs><linearGradient id="g" x1="0" x2="1"><stop offset="0" stop-color="#6574FF"/><stop offset="1" stop-color="#A78BFA"/></linearGradient></defs>
  </svg>);
}

function useLocalStats(){
  const [stats, setStats] = useState(()=> JSON.parse(localStorage.getItem('student.stats')||'{}'));
  useEffect(()=>{ const id=setInterval(()=>setStats(JSON.parse(localStorage.getItem('student.stats')||'{}')),800); return ()=>clearInterval(id); },[]);
  return stats;
}

function Header({toggleTheme,theme}){
  const stats = useLocalStats();
  return (
    <div className="max-w-7xl mx-auto px-6 py-6 flex items-center justify-between">
      <div className="flex items-center gap-4">
        <div className="bg-white/10 p-2 rounded-lg"><Logo/></div>
        <div>
          <div className="text-lg font-semibold text-gray-800 dark:text-gray-100">Student Dashboard</div>
          <div className="text-sm text-gray-500 dark:text-gray-300">AI study companion</div>
        </div>
      </div>
      <div className="flex items-center gap-6">
        <div className="text-sm text-gray-700 dark:text-gray-300 text-right">
          <div>Usage <span className="font-semibold">{stats.usage||0}</span></div>
          <div>Doubts <span className="font-semibold">{stats.doubts||0}</span></div>
        </div>
        <button onClick={toggleTheme} className="p-2 bg-white/10 rounded-lg">{theme==='dark'?'üåô':'üåû'}</button>
      </div>
    </div>
  );
}

function Card({title,desc,icon,onClick}){
  return (
    <div onClick={onClick} className="cursor-pointer bg-white/60 dark:bg-gray-800/60 backdrop-blur-md border border-white/10 dark:border-gray-700/40 rounded-2xl p-6 flex flex-col gap-3 shadow-lg transform transition hover:scale-105">
      <div className="text-3xl">{icon}</div>
      <div className="font-semibold text-gray-800 dark:text-gray-100">{title}</div>
      <div className="text-sm text-gray-600 dark:text-gray-300">{desc}</div>
    </div>
  );
}

// Dashboard view
function Dashboard({openNotes,openDoubts,openTest}){
  return (
    <div className="max-w-7xl mx-auto px-6 py-6">
      <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
        <Card icon="üìÑ" title="Notes Explainer" desc="Upload or paste notes; get clear explanations" onClick={openNotes} />
        <Card icon="üí¨" title="Doubt Solver" desc="Ask step-by-step questions" onClick={openDoubts} />
        <Card icon="üìù" title="Practice Tests" desc="Generate MCQs and take graded tests" onClick={openTest} />
      </div>

      <div className="mt-8 p-6 bg-white dark:bg-gray-800/50 rounded-2xl border border-white/10 shadow-sm">
        <h3 className="font-semibold text-gray-800 dark:text-gray-100">Recent Activity</h3>
        <div className="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4">
          <div className="p-4 bg-white/20 rounded-md">Model calls: <b>{(JSON.parse(localStorage.getItem('student.stats')||'{}').usage)||0}</b></div>
          <div className="p-4 bg-white/20 rounded-md">Doubts solved: <b>{(JSON.parse(localStorage.getItem('student.stats')||'{}').doubts)||0}</b></div>
          <div className="p-4 bg-white/20 rounded-md">Tests taken: <b>{(JSON.parse(localStorage.getItem('student.stats')||'{}').tests)||0}</b></div>
        </div>
      </div>
    </div>
  );
}

// Chat component
function Chat({onBack,apiPath, title}){
  const [messages, setMessages] = useState(JSON.parse(localStorage.getItem(apiPath)||'[]'));
  const [input, setInput] = useState('');
  const [loading, setLoading] = useState(false);
  const boxRef = useRef(null);

  useEffect(()=>{ localStorage.setItem(apiPath, JSON.stringify(messages)); if(boxRef.current) boxRef.current.scrollTop = boxRef.current.scrollHeight; }, [messages]);

  const send = async () => {
    if(!input.trim()) return;
    const text = input.trim();
    setMessages(m=>[...m, {sender:'user', text, ts:Date.now()}]);
    setInput('');
    setLoading(true);
    try{
      const res = await fetch(apiPath, {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(apiPath.includes('explain')?{notesText:text}:{question:text})});
      const data = await res.json();
      const reply = data.answer || data.explanation || 'No response';
      setMessages(m=>[...m, {sender:'bot', text:reply, ts:Date.now()}]);
      // update stats
      const s = JSON.parse(localStorage.getItem('student.stats')||'{}'); s.usage=(s.usage||0)+1; if(apiPath==='/api/ask'){ s.doubts=(s.doubts||0)+1 } localStorage.setItem('student.stats', JSON.stringify(s));
    }catch(e){
      setMessages(m=>[...m, {sender:'bot', text:'Error contacting server', ts:Date.now()}]);
    }finally{ setLoading(false); }
  };

  return (
    <div className="max-w-5xl mx-auto px-6 py-6">
      <button onClick={onBack} className="text-sm text-gray-700 dark:text-gray-300 mb-4">‚Üê Back</button>
      <div className="bg-white dark:bg-gray-800 rounded-2xl p-4 shadow-lg flex flex-col h-[70vh]">
        <div className="flex items-center gap-3 mb-3">
          <div className="w-10 h-10 bg-indigo-500 rounded-full flex items-center justify-center text-white">AI</div>
          <div><div className="font-semibold text-gray-800 dark:text-gray-100">{title}</div><div className="text-xs text-gray-500 dark:text-gray-400">Ask any academic question</div></div>
        </div>
        <div ref={boxRef} className="flex-1 overflow-y-auto p-2 space-y-3">
          {messages.map((m,i)=>(
            <div key={i} className={`max-w-[75%] p-3 rounded-2xl ${m.sender==='user' ? 'ml-auto bg-indigo-600 text-white animate-bounce-soft' : 'bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100'}`}>
              <div style={{whiteSpace:'pre-wrap'}}>{m.text}</div>
            </div>
          ))}
          {loading && <div className="max-w-[60%] p-3 rounded-2xl bg-gray-100 dark:bg-gray-700 text-gray-800">Typing‚Ä¶</div>}
        </div>
        <div className="mt-3 flex gap-2">
          <input value={input} onChange={e=>setInput(e.target.value)} onKeyDown={e=>e.key==='Enter' && send()} className="flex-1 rounded-xl p-3 border dark:border-gray-700" placeholder="Type your question..." />
          <button onClick={send} className="px-4 py-2 bg-indigo-600 text-white rounded-xl">{loading?'Sending‚Ä¶':'Send'}</button>
        </div>
      </div>
    </div>
  );
}

// Practice Test
function Practice({onBack}){
  const [subject,setSubject]=useState('Math'); const [topic,setTopic]=useState('Algebra'); const [count,setCount]=useState(5);
  const [questions,setQuestions]=useState([]); const [answers,setAnswers]=useState({}); const [result,setResult]=useState(null); const [loading,setLoading]=useState(false);

  const generate = async ()=>{
    setLoading(true);
    try{
      const res = await fetch('/api/generate-test',{method:'POST',headers:{'Content-Type':'application/json'},body: JSON.stringify({subject,topic,count})});
      const data = await res.json();
      setQuestions(data.questions||[]);
    }catch(e){ alert('Error generating test'); }
    setLoading(false);
  };

  const submit = ()=>{
    let score=0;
    questions.forEach((q,i)=>{ if(Number(answers[i])===Number(q.answer)) score++; });
    setResult({score,total:questions.length});
    const s = JSON.parse(localStorage.getItem('student.stats')||'{}'); s.tests=(s.tests||0)+1; localStorage.setItem('student.stats', JSON.stringify(s));
  };

  return (
    <div className="max-w-5xl mx-auto px-6 py-6">
      <button onClick={onBack} className="text-sm text-gray-700 dark:text-gray-300 mb-4">‚Üê Back</button>
      <div className="bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-lg">
        <h3 className="font-semibold mb-3">Practice Test</h3>
        <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
          <input value={subject} onChange={e=>setSubject(e.target.value)} className="p-3 border rounded-xl" />
          <input value={topic} onChange={e=>setTopic(e.target.value)} className="p-3 border rounded-xl" />
          <input type="number" value={count} onChange={e=>setCount(e.target.value)} className="p-3 border rounded-xl" />
        </div>
        <div className="mt-3 flex gap-2"><button onClick={generate} className="px-4 py-2 bg-indigo-600 text-white rounded-xl">{loading?'Generating...':'Generate Test'}</button></div>
        {questions.length>0 && <form onSubmit={e=>{e.preventDefault(); submit();}} className="mt-4 space-y-3">
          {questions.map((q,i)=>(
            <div key={i} className="p-3 border rounded-md">
              <div className="font-medium">{i+1}. {q.question}</div>
              <div className="mt-2 grid grid-cols-1 gap-2">
                {q.options.map((op,idx)=>(
                  <label key={idx} className="flex items-center gap-2"><input type="radio" name={"q"+i} value={idx} onChange={()=>setAnswers(a=>({...a,[i]:idx}))} /> <span>{op}</span></label>
                ))}
              </div>
            </div>
          ))}
          <div><button type="submit" className="px-4 py-2 bg-green-600 text-white rounded-xl">Submit Test</button></div>
        </form>}
        {result && <div className="mt-4 p-3 bg-gray-50 dark:bg-gray-700 rounded-md">Score: <b>{result.score}/{result.total}</b></div>}
      </div>
    </div>
  );
}

function App(){
  const [view,setView]=useState('dashboard');
  const [theme,setTheme]=useState(localStorage.getItem('theme')||'light');
  useEffect(()=>{ document.documentElement.classList.toggle('dark', theme==='dark'); localStorage.setItem('theme', theme); }, [theme]);

  return (
    <div className="min-h-screen bg-gradient-to-b from-gray-50 to-white dark:from-gray-900 dark:to-gray-800">
      <Header toggleTheme={()=>setTheme(t=>t==='dark'?'light':'dark')} theme={theme} />
      {view==='dashboard' && <Dashboard openNotes={()=>setView('notes')} openDoubts={()=>setView('doubts')} openTest={()=>setView('test')} />}
      {view==='notes' && <Chat onBack={()=>setView('dashboard')} apiPath={'/api/explain-notes'} title={'Notes Explainer'} />}
      {view==='doubts' && <Chat onBack={()=>setView('dashboard')} apiPath={'/api/ask'} title={'Doubt Solver'} />}
      {view==='test' && <Practice onBack={()=>setView('dashboard')} />}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>

    <style>
    /* subtle bounce animation */
    @keyframes bounce-soft { 0%{ transform: translateY(6px); } 50%{ transform: translateY(0); } 100%{ transform: translateY(6px); } }
    .animate-bounce-soft { animation: bounce-soft 0.6s ease both; }
    </style>
  </body>
</html>
